---
title: "Rui Huang"
output: html_document
date: "2024-07-08"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(terra)
library(rerddap)
library(tidyverse)
```


```{r}
#Loading dataset
Tempinfo = info('erdCinpKfmT')
tempset = tabledap(Tempinfo)
Kelpinfo = info('erdCinpKfmRPC')
kelpset = tabledap(Kelpinfo)
Heatwavedata = rast("subset (1).nc")
```
```{r}
# Adding character in dataframe for temporary dataset
temp_tempset = tempset %>% 
  mutate(data_char = as.character(time))
```

```{r}
#Filters for July 1st
temp_tempset = temp_tempset %>% 
  filter(grepl("-07-01",data_char, fixed = TRUE))
```

```{r}
#Look for avg temerature and max temperature via iteration
repvector = rep(0, 2007-1994+1)
tempvector = rep(0, 2007-1994+1)
maxtempvector = rep(0, 2007-1994+1)
for(i in 1:nrow(temp_tempset)){
  yearval = as.numeric(str_sub(temp_tempset$data_char[i], 1, 4))
  index = yearval - 1993
  repvector[index] = repvector[index] + 1
  tempvector[index] = tempvector[index] + temp_tempset$temperature[i]
  maxtempvector[index] = max(maxtempvector[index], temp_tempset$temperature[i])
}
avgtempvector = rep(0, 2007-1994+1)
for(i in 1:length(tempvector)){
  avgtempvector[i] = tempvector[i]/repvector[i]
}
```

```{r}
#Plots data
timevector = c(0: (2007-1994))
#tempdf = data.frame(avgtempvector, timevector)
ggplot() +
  geom_point(aes(x = timevector, y = avgtempvector))
ggplot() +
  geom_point(aes(x = timevector, y = maxtempvector))
lrdf = data.frame(maxtempvector,timevector)
lm(maxtempvector~timevector ,data = lrdf)
```
```{r}
#Creates heatwave dataframe
Heatwavedf = as.data.frame(Heatwavedata, xy = T)
```

```{r}
hwdf_comp = Heatwavedf %>% 
  mutate(x2 = x - 360) %>% 
  relocate(x2, .after = x) %>% 
  filter(x2 >= -118.4 | x2 <= -120.4) %>% 
  filter(y >= 32.8, y <= 34.05) %>% 
  slice(18)
```

```{r}
hwvector = as.numeric(hwdf_comp[1,])
timedate = as.Date("1992-12-31")
count = 1
filteredhwvector = rep(0, (2007-1993))
for(i in 4:length(hwvector)){
  if(grepl("-07-01",as.character(timedate),fixed = TRUE)){
      filteredhwvector[count] = hwvector[i]
      print(timedate)
      count = count +1
  }
  timedate = timedate + 1
}


```
```{r}
tvector = c(0:14)
ggplot() +
  geom_point(aes(x = tvector, y = filteredhwvector)) +
  geom_line() +
  geom_smooth(method = "lm")
dfhw = data.frame(filteredhwvector, tvector)
lm(filteredhwvector~tvector ,data = dfhw)
```

